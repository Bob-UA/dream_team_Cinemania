import"./switcher-3337534c.js";import{g as k,a as w,b as I,s as b,r as s,c as E,d as B}from"./catalog_hero-9a70a6f0.js";function C(e){return e.length>20?e.substring(0,20)+"...":e}function T(e,t,n,r,i,d){if(!e)return;let a="";return r.length?a=C(r.slice(0,2).join(", ")):a="There are no genres",`<li class="gallery-movies-item" data-id="${n}">
        <img class="gallery-movies-img" src="https://image.tmdb.org/t/p/original/${e}" alt="${t}" loading="lazy">
        <div class="gallery-movies-overlay js-modal-info" data-id="${n}"></div>
            <div class="gallery-movies-description">
                <h3 class="gallery-movies-title">${t}</h3>
                <div class="gallery-movies-wrap">
                <p class="gallery-movies-details">${a} | ${i}</p>
                <img src="${d}" alt="raiting" class="star-rating-card"/>
                </div>
            </div>
        </li>`}const g=document.querySelector(".search-movie"),M=document.querySelector(".gallery-movies"),v=document.querySelector(".no-results"),$=await k();M.innerHTML=await h($.data.results);g.addEventListener("submit",O);async function O(e){e.preventDefault(),M.innerHTML="";const{search:t}=e.currentTarget.elements,n=t.value.trim();if(n==""||!n){v.hidden=!1,g.reset();return}const r=await w(n);if(r.data.results.length==0){v.hidden=!1,g.reset();return}v.hidden=!0,console.log(M.innerHTML=await h(r.data.results)),g.reset()}async function h(e){const t=e.map(async({poster_path:r,title:i,genre_ids:d,id:a,release_date:l,vote_average:c})=>{const o=l.substr(0,4),m=await j(d),u=b(c);return T(r,i,a,m,o,u)});return(await Promise.all(t)).join("")}async function j(e){const t=await I(),n=[];for(let r=0;r<e.length;r++)for(let i=0;i<t.data.genres.length;i++)Object.values(t.data.genres[i])[0]==e[r]&&n.push(Object.values(t.data.genres[i])[1]);return n}const f="MY_LIBRARY";s.gallaryContainer.addEventListener("click",R);function L(e){e.currentTarget===e.target&&(s.backdropMovieInfoContainer.classList.add("is-hidden"),s.movieInfoContainer.innerHTML="",s.backdropMovieInfoContainer.removeEventListener("click",L))}function S(e){const t="Escape";e.code==t&&(s.backdropMovieInfoContainer.classList.add("is-hidden"),s.movieInfoContainer.innerHTML="",window.removeEventListener("keydown",S))}async function R(e){if(!e.target.classList.contains("js-modal-info"))return;s.backdropMovieInfoContainer.addEventListener("click",L),window.addEventListener("keydown",S),s.closeModalBtn.addEventListener("click",p);const n=+e.target.dataset.id,{data:r}=await q(n),i=r,d=await E(i);s.movieInfoContainer.insertAdjacentHTML("beforeend",d),s.modal.classList.toggle("is-hidden");const a={addBtn:document.querySelector(".add-btn"),removeBtm:document.querySelector(".remove-btn")},l=G(f);l&&l.map(c=>{if(c.id===n){a.addBtn.classList.add("hide"),a.removeBtm.classList.remove("hide");return}}),a.addBtn.addEventListener("click",()=>{let c="";if(l){const u=JSON.stringify(l);c=H(u)}const o=JSON.stringify(i),m=N(o,c);a.addBtn.classList.toggle("hide"),a.removeBtm.classList.toggle("hide"),y(f,m)}),a.removeBtm.addEventListener("click",()=>{a.addBtn.classList.toggle("hide"),a.removeBtm.classList.toggle("hide");const c=l.map(o=>{if(o.id!==n)return o}).filter(o=>{if(o)return o});y(f,c)})}function G(e){try{const t=localStorage.getItem(e);return t===null?void 0:JSON.parse(t)}catch(t){console.error("Get state error: ",t.message)}}function y(e,t){try{const n=JSON.stringify(t);localStorage.setItem(e,n)}catch(n){console.error("Set state error: ",n.message)}}function H(e){return e.slice(1,e.length-1)}function N(e,t){return JSON.parse(t?`[${t}, ${e}]`:`[${e}]`)}function p(){s.modal.classList.toggle("is-hidden"),s.movieInfoContainer.innerHTML="",s.closeModalBtn.removeEventListener("click",p)}async function q(e){return await B(e)}
