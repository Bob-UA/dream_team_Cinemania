import"./switcher-0dc0b702.js";import{g as k,a as I,b,r as o,c as w,d as E}from"./catalog_hero-5dd838cb.js";function B(e){return e.length>20?e.substring(0,20)+"...":e}function T(e,t,n,r,s){if(!e)return;let l="";return r.length?l=B(r.slice(0,2).join(", ")):l="There are no genres",`<li class="gallery-movies-item" data-id="${n}">
        <img class="gallery-movies-img" src="https://image.tmdb.org/t/p/original/${e}" alt="${t}" loading="lazy">
        <div class="gallery-movies-overlay js-modal-info" data-id="${n}"></div>
            <div class="gallery-movies-description">
                <h3 class="gallery-movies-title">${t}</h3>
                <p class="gallery-movies-details">${l} | ${s}</p>
            </div>
        </li>`}const m=document.querySelector(".search-movie"),v=document.querySelector(".gallery-movies"),u=document.querySelector(".no-results"),C=await k();v.innerHTML=await M(C.data.results);m.addEventListener("submit",O);async function O(e){e.preventDefault(),v.innerHTML="";const{search:t}=e.currentTarget.elements,n=t.value.trim();if(n==""||!n){u.hidden=!1,m.reset();return}const r=await I(n);if(r.data.results.length==0){u.hidden=!1,m.reset();return}u.hidden=!0,console.log(v.innerHTML=await M(r.data.results)),m.reset()}async function M(e){const t=e.map(async({poster_path:r,title:s,genre_ids:l,id:a,release_date:d})=>{const c=d.substr(0,4),i=await $(l);return T(r,s,a,i,c)});return(await Promise.all(t)).join("")}async function $(e){const t=await b(),n=[];for(let r=0;r<e.length;r++)for(let s=0;s<t.data.genres.length;s++)Object.values(t.data.genres[s])[0]==e[r]&&n.push(Object.values(t.data.genres[s])[1]);return n}const g="MY_LIBRARY";o.gallaryContainer.addEventListener("click",j);function y(e){e.currentTarget===e.target&&(o.backdropMovieInfoContainer.classList.add("is-hidden"),o.movieInfoContainer.innerHTML="",o.backdropMovieInfoContainer.removeEventListener("click",y))}function h(e){const t="Escape";e.code==t&&(o.backdropMovieInfoContainer.classList.add("is-hidden"),o.movieInfoContainer.innerHTML="",window.removeEventListener("keydown",h))}async function j(e){if(!e.target.classList.contains("js-modal-info"))return;o.backdropMovieInfoContainer.addEventListener("click",y),window.addEventListener("keydown",h),o.closeModalBtn.addEventListener("click",L);const n=+e.target.dataset.id,{data:r}=await R(n),s=r,l=await w(s);o.movieInfoContainer.insertAdjacentHTML("beforeend",l),o.modal.classList.toggle("is-hidden");const a={addBtn:document.querySelector(".add-btn"),removeBtm:document.querySelector(".remove-btn")},d=G(g);d&&d.map(c=>{if(c.id===n){a.addBtn.classList.add("hide"),a.removeBtm.classList.remove("hide");return}}),a.addBtn.addEventListener("click",()=>{let c="";if(d){const p=JSON.stringify(d);c=H(p)}const i=JSON.stringify(s),S=N(i,c);a.addBtn.classList.toggle("hide"),a.removeBtm.classList.toggle("hide"),f(g,S)}),a.removeBtm.addEventListener("click",()=>{a.addBtn.classList.toggle("hide"),a.removeBtm.classList.toggle("hide");const c=d.map(i=>{if(i.id!==n)return i}).filter(i=>{if(i)return i});f(g,c)})}function G(e){try{const t=localStorage.getItem(e);return t===null?void 0:JSON.parse(t)}catch(t){console.error("Get state error: ",t.message)}}function f(e,t){try{const n=JSON.stringify(t);localStorage.setItem(e,n)}catch(n){console.error("Set state error: ",n.message)}}function H(e){return e.slice(1,e.length-1)}function N(e,t){return JSON.parse(t?`[${t}, ${e}]`:`[${e}]`)}function L(){o.modal.classList.toggle("is-hidden"),o.movieInfoContainer.innerHTML="",o.closeModalBtn.removeEventListener("click",L)}async function R(e){return await E(e)}
